<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Material Design fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdn.rawgit.com/FezVrasta/bootstrap-material-design/dist/dist/bootstrap-material-design.min.css">
    <title>Lornsenschule Vertretungsplan</title>
  </head>
  <body>
    <div class="bmd-layout-container" id="Main">
      <main class="bmd-layout-content">
        <div class="container">
          <h1 id="school"></h1></br>

          <ul class="nav nav-tabs" id="Tabs">
            <li class="active"><a data-target="#vertretungen" data-toggle="tab">Profile</a></li>
            <li><a data-target="#messages" data-toggle="tab">Messages</a></li>
          </ul>

          <div class="tab-content">
            <div class="tab-pane active" id="vertretungen"></div>
            <div class="tab-pane" id="messages"></div>
          </div>

        </div>
      </main>
     </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script>
      window.$ = window.jQuery = require('./js/jquery-3.1.0.min.js');
      var request = require("request")
      //<!-- http://THIS_IS_AN_SECRET_DOMAIN -->
      var url = "http://THIS_IS_AN_SECRET_DOMAIN/vertretungsplan?" +
        "school=Schleswig_Lornsenschule" +
        "&v=1337"

      if (typeof jQuery == 'undefined') {  
        console.warn("JQUERY NOT LOADED!!!");
      }

      request({
        url: url,
        json: true
      }, function (error, response, body) {

        if (!error && response.statusCode === 200) {
          //var lsJson = JSON.parse(body);
          document.all.school.innerHTML = body.schoolName + ' Vertretungsplan'; // Print the json response
          for (var key in body.tage) {
            if (body.tage.hasOwnProperty(key)) {
              //////////////////////////////////////////////////////////////
              //////////////////////////////////////////////////////////////
              //                                                          //
              //                      1 == morgen                         //
              //                      0 == heute                          //
              //                                                          //
              //////////////////////////////////////////////////////////////
              //////////////////////////////////////////////////////////////
              if (key == 1) {
                classes = body.tage[key].klassen
                for (var key in classes) {
                  if (classes.hasOwnProperty(key)) {
                    klassen = classes[key]
                    klasse = klassen.klasse
                    $("#vertretungen").append('<h3>' + klasse + '</h3>')
                    representations = classes[key].vertretung
                    for (var key in representations) {
                      if (representations.hasOwnProperty(key)) {
                        representations_details = representations[key]
                        var reg = new RegExp('[-]');
                        lesson = representations_details.lesson
                        representation_type = representations_details.type
                        text = representations_details.text
                        if (representation_type == "Vertretung") {
                          if (lesson.match(reg)) {
                            $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #2196F3; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 300%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + representation_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                          }else{
                            $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #2196F3; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 350%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + representation_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                          }
                        }else{
                          if (representation_type == "Betreuung") {
                            if (lesson.match(reg)) {
                              $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #2196F3; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 300%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + representation_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                            }else{
                              $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #2196F3; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 350%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + representation_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                            }
                          }else{
                            if (representation_type == "Unterricht ge√§ndert") {
                              if (lesson.match(reg)) {
                                $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #FFA000; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 300%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + representation_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                              }else{
                                $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #FFA000; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 350%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + representation_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                              }
                            }else{
                              if (representation_type == "Lehrertausch") {
                                if (lesson.match(reg)) {
                                  $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #9C27B0; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 300%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + representation_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                                }else{
                                  $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #9C27B0; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 350%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + representation_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          } 
        }else{
            $("#Main").append('<p class="bg-danger">Scheinbar geht dein Internet nicht :/</p>')
          }
      })

      $('#Tabs a:last').tab('show')
    </script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap/bootstrap.min.js"></script>
    <script src="https://cdn.rawgit.com/HubSpot/tether/v1.3.4/dist/js/tether.min.js"></script>
    <script src="https://cdn.rawgit.com/FezVrasta/bootstrap-material-design/dist/dist/bootstrap-material-design.iife.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
