<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Material Design fonts -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdn.rawgit.com/FezVrasta/bootstrap-material-design/dist/dist/bootstrap-material-design.min.css">
    <title>Lornsenschule Vertretungsplan</title>
  </head>
  <body>
    <div class="bmd-layout-container" id="Main">
      <main class="bmd-layout-content">
        <div class="container">
          <h1 id="school"></h1></br>

          <ul class="nav nav-tabs" id="Tabs">
            <li class="active"><a data-target="#vertretungen" data-toggle="tab">Profile</a></li>
            <li><a data-target="#messages" data-toggle="tab">Messages</a></li>
          </ul>

          <div class="tab-content">
            <div class="tab-pane active" id="vertretungen"></div>
            <div class="tab-pane" id="messages"></div>
          </div>

        </div>
      </main>
     </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script>
      /*
      Refresh Button Snippets:
      var remote = require('electron').remote
      remote.getCurrentWindow().reload()
      */
      window.$ = window.jQuery = require('./js/jquery-3.1.0.min.js');
      var request = require('request')
      ,   cachedRequest = require('cached-request')(request)
      ,   cacheDirectory = "cache";
      var url = "https://api.vertretungsplan.me/" +
        "v2/" +
        "substitutionschedules/" +
        "Schleswig_Lornsenschule/" +
        "schulervertretungsplan" +
        "?client=desktop_marcel"

      cachedRequest({
        url: url,
        json: true,
        ttl: 1800000
      }, function (error, response, body) {
        if (!error && response.statusCode === 200) {
          document.all.school.innerHTML = body.schoolId.replace(/_/g, ' ') + ' Vertretungsplan'; // Print the json response
          for (var key in body.days) {
            if (body.days.hasOwnProperty(key)) {
              //////////////////////////////////////////////////////////////
              //////////////////////////////////////////////////////////////
              //                                                          //
              //                      1 == morgen                         //
              //                      0 == heute                          //
              //                                                          //
              //////////////////////////////////////////////////////////////
              //////////////////////////////////////////////////////////////
              if (key == 0) {
                date = body.days[key].dateString
                substitutions = body.days[key].substitutions
                substitutions.sort(function(a, b){
                  if (a.classes < b.classes) return -1;
                  if (b.classes < a.classes) return 1;
                  return 0;
                })
                for (var key in substitutions) {
                  if (substitutions.hasOwnProperty(key)) {
                    klasse = substitutions[key].classes
                    if ($("#klasse").attr("klasse") != klasse) {
                      $("#vertretungen").append('<h3 id="klasse" klasse="' + klasse + '">' + klasse + '</h3>')
                    }
                    var reg = new RegExp('[-]');
                    lesson = substitutions[key].lesson
                    substitutions_type = substitutions[key].type
                    text = substitutions[key].text
                    if (substitutions_type == "Vertretung") {
                      if (lesson.match(reg)) {
                        $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #2196F3; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 300%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + substitutions_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                      }else{
                        $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #2196F3; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 350%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + substitutions_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                      }
                    }else{
                      if (substitutions_type == "Betreuung") {
                        if (lesson.match(reg)) {
                          $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #2196F3; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 300%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + substitutions_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                        }else{
                          $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #2196F3; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 350%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + substitutions_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                        }
                      }else{
                        if (substitutions_type == "Unterricht ge√§ndert") {
                          if (lesson.match(reg)) {
                            $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #FFA000; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 300%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + substitutions_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                          }else{
                            $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #FFA000; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 350%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + substitutions_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                          }
                        }else{
                          if (substitutions_type == "Lehrertausch") {
                            if (lesson.match(reg)) {
                              $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #9C27B0; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 300%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + substitutions_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                            }else{
                              $("#vertretungen").append('<div class="card card-block" style="height: 10%; background-color: #9C27B0; color: #fff">' + '<div class="row">' + '<div class="col-md-4" style="position: relative; margin: 0;"><p style="font-size: 350%; margin: 0; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">' + lesson + '</p></div>' + '<div class="col-md-8"><h4>' + substitutions_type + '</h4></br><h7>' + text + '</h7></div>' + '</div>' + '</div>')
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }else{
            $("#Main").append('<p class="bg-danger">Scheinbar geht dein Internet nicht :/</p>')
          }
      })

      $('#Tabs a:last').tab('show')
    </script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap/bootstrap.min.js"></script>
    <script src="https://cdn.rawgit.com/HubSpot/tether/v1.3.4/dist/js/tether.min.js"></script>
    <script src="https://cdn.rawgit.com/FezVrasta/bootstrap-material-design/dist/dist/bootstrap-material-design.iife.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
